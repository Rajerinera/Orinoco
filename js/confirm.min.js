const getProduct=localStorage.getItem("adrienR_p5");let productData=JSON.parse(getProduct);function addCart(){if(productData.length>0){document.getElementById("cart_empty").remove();const table=document.getElementById("table");let tr=document.createElement("tr"),th_name=document.createElement("th"),th_price=document.createElement("th"),th_quantity=document.createElement("th"),th_remove=document.createElement("th");table.appendChild(tr),tr.appendChild(th_name),tr.appendChild(th_price),tr.appendChild(th_quantity),tr.appendChild(th_remove),th_name.textContent="Votre produit",th_price.textContent="Prix",th_quantity.textContent="Quantité",th_remove.textContent=" ";for(let i=0;i<productData.length;i++){let tr_container=document.createElement("tr"),td_name=document.createElement("td"),td_price=document.createElement("td"),td_quantity=document.createElement("td"),td_remove=document.createElement("td"),removeArticle=document.createElement("a");removeArticle.setAttribute("id","remove"+[i]),removeArticle.setAttribute("title","Supprimer"),removeArticle.setAttribute("class","remove1"),console.log(i),removeArticle.addEventListener("click",event=>{this.annulerArticle(i)}),table.appendChild(tr_container),tr_container.appendChild(td_name),tr_container.appendChild(td_price),tr_container.appendChild(td_quantity),tr_container.appendChild(td_remove),td_remove.appendChild(removeArticle),td_name.innerHTML=productData[i].name,td_price.innerHTML=productData[i].price/100+" €",td_quantity.innerHTML=productData[i].quantity,console.log(productData[i].name)}let tr_container_total=document.createElement("tr"),th_total=document.createElement("th"),td_total=document.createElement("td");table.appendChild(tr_container_total),tr_container_total.appendChild(th_total),tr_container_total.appendChild(td_total),th_total.textContent="Total :",td_total.setAttribute("id","totalCartS");let totalPaid=0;for(let i=0;i<productData.length;i++)totalPaid+=productData[i].price/100*productData[i].quantity;document.getElementById("totalCartS").textContent=totalPaid+" €",console.log("le total au sein du panier est de "+totalPaid)}}addCart(),annulerArticle=i=>{productData.splice(i,1),localStorage.clear(),localStorage.setItem("adrienR_p5",JSON.stringify(productData)),window.location.reload()};const btn_remove=document.querySelector("#button_remove");function removeItem(){localStorage.removeItem("adrienR_p5"),productData=[],table.innerHTML="";let a_lien=document.createElement("a");a_lien.className="button_remove1",a_lien.href="../index.html",a_lien.textContent="Revenir à vos achats!",table.appendChild(a_lien)}btn_remove.addEventListener("click",removeItem);const checkInput=()=>{let checkNumber=/[0-9]/,checkMail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,checkSpecialCharacter=/[§!@#$%^&*().?":{}|<>]/,checkMessage="",nom=document.getElementById("nom").value,prenom=document.getElementById("prenom").value,email=document.getElementById("email").value,adresse=document.getElementById("adresse").value,ville=document.getElementById("ville").value;if(1==checkNumber.test(nom)||1==checkSpecialCharacter.test(nom)||0==nom.trim().length?checkMessage="Veuillez vérifier les informations concernant votre nom. Les caractères spéciaux ou les chiffres ne sont pas autorisés":console.log("Nom accepté"),1==checkNumber.test(prenom)||1==checkSpecialCharacter.test(prenom)||0==prenom.trim().length?checkMessage+="\nVeuillez vérifier les informations concernant votre prénom. Les caractères spéciaux ou les chiffres ne sont pas autorisés":console.log("Prénom accepté"),0==checkMail.test(email)?checkMessage+="\nVeuillez vérifier les informations concernant votre email. Les caractères spéciaux ne sont pas autorisés":console.log("Adresse mail acceptée"),1==checkSpecialCharacter.test(adresse)||0==adresse.trim().length?checkMessage+="\nVeuillez vérifier les informations concernant votre adresse postale. Les caractères spéciaux ne sont pas autorisés":console.log("Adresse postale acceptée"),1==checkSpecialCharacter.test(ville)||1==checkNumber.test(ville)||0==ville.trim().length?checkMessage+="\nVeuillez vérifier les informations concernant votre ville. Les caractères spéciaux ou les chiffres ne sont pas autorisés":console.log("Ville acceptée"),""==checkMessage)return contact={lastName:nom,firstName:prenom,address:adresse,city:ville,email:email},contact;alert("Attention certaines données ne sont pas conformes :\n"+checkMessage)},checkPanier=()=>{let productData=JSON.parse(localStorage.getItem("adrienR_p5"));return productData.length<1||null==productData?(alert("Votre panier est vide"),!1):(console.log("Le panier n'est pas vide"),!0)};let contact,products=[],url="http://localhost:3000/api/cameras/order";const sendFormule=(sendForm,url)=>new Promise(resolve=>{let request=new XMLHttpRequest;request.onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&201==this.status&&(sessionStorage.setItem("order",this.responseText),window.location="./pagevalid.html",resolve(JSON.parse(this.responseText)),console.log(sendForm))},request.open("POST",url),request.setRequestHeader("Content-Type","application/json"),request.send(sendForm),console.log(sendForm)});confirmCommande=()=>{let commander;document.getElementById("envoi").addEventListener("submit",event=>{if(event.preventDefault(),1==checkPanier()&&null!=checkInput()){console.log("L'envoi peut etre fait"),productData.forEach(produit=>{products.push(produit._id)}),console.log("Ce tableau sera envoyé à l'API : "+products);let commande={contact:contact,products:products},sendForm=JSON.stringify(commande);sendFormule(sendForm,url),console.log(commande),contact={},products=[],localStorage.clear()}else console.log("ERROR")})};